{% extends 'base.html' %}
{% block content %}
<div class="row mb-3">
  <div class="col-md-8">
    <h2>{{ customer.full_name() }}</h2>
    <p>Email: {{ customer.email or '—' }} | Telefon: {{ customer.phone or '—' }}</p>
  </div>
  <div class="col-md-4 text-end">
    <p><strong>Umsatz Gesamt:</strong> {{ '€{:.2f}'.format(total_revenue or 0) }}</p>
    <p><strong>Umsatz letztes Jahr:</strong> {{ '€{:.2f}'.format(revenue_last_year or 0) }}</p>
  </div>
</div>

<div class="card mb-3">
  <div class="card-body">
    <form class="row g-2" method="get">
      <div class="col-auto"><label class="form-label">Von</label><input class="form-control" type="date" name="start" value="{{ start or '' }}"></div>
      <div class="col-auto"><label class="form-label">Bis</label><input class="form-control" type="date" name="end" value="{{ end or '' }}"></div>
      <div class="col-auto align-self-end"><button class="btn btn-primary" type="submit">Filter</button></div>
    </form>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <h5>Letzte Bestellungen</h5>
    <table class="table table-sm">
      <thead><tr><th>Datum</th><th>Betrag</th><th>Beschreibung</th></tr></thead>
      <tbody>
        {% for o in orders %}
          <tr>
            <td>{{ o.created_at.strftime('%Y-%m-%d') }}</td>
            <td>{{ '€{:.2f}'.format(o.amount) }}</td>
            <td>{{ o.description }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3">Keine Bestellungen.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-md-6">
    <h5>Letzte Kontakte</h5>
    <table class="table table-sm">
      <thead><tr><th>Datum</th><th>Art</th><th>Notiz</th></tr></thead>
      <tbody>
        {% for ct in contacts %}
          <tr>
            <td>{{ ct.created_at.strftime('%Y-%m-%d') }}</td>
            <td>{{ ct.kind }}</td>
            <td>{{ ct.note }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3">Keine Kontakte.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
